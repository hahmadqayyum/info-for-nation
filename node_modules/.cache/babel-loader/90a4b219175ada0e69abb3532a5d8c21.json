{"ast":null,"code":"function ConfigObject(items) {\n  for (let i in items) {\n    this[i] = {\n      name: items[i]\n    };\n  }\n}\n\n_c = ConfigObject;\nconst boolItems = {\n  borders: \"Borders\",\n  alwaysopen: \"Keep all squares open\",\n  background_image: \"Enable background image\",\n  hide_gear_button: \"Make gear button invisible\"\n};\nconst bool = new ConfigObject(boolItems);\nconst styleItems = {\n  square_size: \"Square Size\",\n  square_spacing: \"Square Spacing\",\n  heading_font: \"Heading Font\",\n  link_font: \"Link Font\",\n  heading_font_size: \"Heading Font Size\",\n  link_font_size: \"Link Font Size\",\n  background: \"Background\",\n  foreground: \"Foreground\",\n  heading_color: \"Heading Color\",\n  link_color: \"Link Color\",\n  border_color: \"Border Color\",\n  border_width_normal: \"Border Width\",\n  border_width_hovered: \"Border Width (Hovered)\",\n  border_radius: \"Border Radius\",\n  square_shadow: \"Square Shadow\",\n  focus_color: \"Focus Color\",\n  focus_bg_color: \"Focus Background Color\",\n  search_color: \"Search Color\",\n  search_bg_color: \"Search Background Color\"\n};\nconst style = new ConfigObject(styleItems);\nconst extItems = {\n  images: \"Images\",\n  size: \"Size\",\n  filter: \"Filter\"\n};\nconst ext = new ConfigObject(extItems);\n\nfunction configmenuInit(callback) {\n  browser.storage.local.get(\"config\").then(configData => {\n    // Check if configData is empty\n    if (Object.keys(configData).length === 0 && configData.constructor === Object) {\n      $.loadJSON(\"config.json\", configJSON => {\n        initmenu = new Menu(\"Init-Menu\", 550, 350);\n        initmenu.appendTab(\"Choose an Option\");\n        initmenu.makeTabActive(0);\n        const initbuttons = initmenu.split([\"Use defaults.\", \"Use configuration menu.\"], [\"Use the example config. You can later open up the \" + \"configuration menu by clicking the gear icon in the \" + \"bottom-right corner of the screen.\", \"Use a GUI to easily configure the startpage's style. Has \" + \"import/export function.\"]);\n        initbuttons[0].addEventListener(\"click\", () => {\n          browser.storage.local.set({\n            config: configJSON\n          });\n          applyConfig(configJSON, callback);\n          initmenu.kill();\n        });\n        initbuttons[1].addEventListener(\"click\", () => {\n          browser.storage.local.set({\n            config: configJSON\n          });\n          applyConfig(configJSON, undefined);\n          createMenu(configJSON, callback);\n          initmenu.kill();\n        });\n      });\n    } else if (typeof callback === \"function\") {\n      applyConfig(configData.config, callback);\n    } else {\n      createMenu(configData.config, callback);\n    }\n  }, err => {\n    alert(\"An error occured while loading the config.\");\n    console.log(err);\n  });\n}\n\nfunction createMenu(data, callback) {\n  configmenu = new Menu(\"Config-Menu\", 750, -100);\n  const squareTab = configmenu.appendTab(\"Squares\");\n  const styleTab = configmenu.appendTab(\"Style\");\n  configmenu.makeTabActive(0);\n  squareTab.node.addEventListener(\"click\", function () {\n    configmenu.makeTabActive(0);\n  });\n  styleTab.node.addEventListener(\"click\", function () {\n    configmenu.makeTabActive(1);\n  }); // squares\n\n  const normalcategory = squareTab.appendCategory(\"normal\", undefined);\n\n  if (data.squares) {\n    let i = 0;\n\n    while (i < data.squares.length) {\n      if (data.squares[i].options === undefined) {\n        let div = configmenu.tabs[0].categories[0].appendSquareDiv(data.squares[i].name);\n        configmenu.tabs[0].categories[0].options[i].appendTextField(\"heading\" + i, i, \"squareHeading\", data.squares[i].name, 1, i, normalcategory);\n\n        for (let a = 0; a < data.squares[i].links.length; a++) {\n          const tf = configmenu.tabs[0].categories[0].options[i].appendTextField(\"link\" + i, [i, \"url\"], \"squareURL\", [data.squares[i].links[a].name, data.squares[i].links[a].url], 2, i, normalcategory);\n        }\n      } else {\n        // search\n        let div = configmenu.tabs[0].categories[0].appendSquareDiv(data.squares[i].name);\n        configmenu.tabs[0].categories[0].options[i].appendTextField(\"heading\" + i, [i, \"prefix\"], \"squareHeading\", [data.squares[i].name, data.squares[i].prefix], 2, i, normalcategory);\n\n        for (let a = 0; a < data.squares[i].options.length; a++) {\n          const tf = configmenu.tabs[0].categories[0].options[i].appendTextField(\"option\" + i, [\"opt\", \"url\", \"space\"], \"squareOption\", [data.squares[i].options[a].opt, data.squares[i].options[a].url, data.squares[i].options[a].space], 3, i, normalcategory);\n        }\n      }\n\n      if (data.squares[i].options === undefined) {\n        const add = configmenu.tabs[0].categories[0].options[i].appendTextField(\"link\" + i, undefined, \"squareURL\", undefined, 0, i, normalcategory);\n      } else {\n        const add = configmenu.tabs[0].categories[0].options[i].appendTextField(\"option\" + i, undefined, \"squareOption\", undefined, 0, i, normalcategory);\n      }\n\n      i++;\n    } // square/search add button\n\n\n    const newDiv = normalcategory.appendSquareDiv();\n    const opts = configmenu.tabs[0].categories[0].options;\n    opts[opts.length - 1].appendTextField(undefined, undefined, \"squareHeading\", undefined, 0, i, normalcategory);\n    opts[opts.length - 1].appendTextField(undefined, undefined, \"squareHeading_addS\", undefined, 0, i, normalcategory);\n  } else {\n    // empty squares\n    let div = configmenu.tabs[0].categories[0].appendSquareDiv(\"default\");\n    configmenu.tabs[0].categories[0].options[0].appendTextField(undefined, undefined, \"squareHeading\", undefined, 0, undefined, normalcategory);\n    configmenu.tabs[0].categories[0].options[0].appendTextField(undefined, undefined, \"squareHeading_addS\", undefined, 0, undefined, normalcategory);\n  } // style\n\n\n  const boolcategory = styleTab.appendCategory(\"bool\", undefined);\n  const stylecategory = styleTab.appendCategory(\"style\", \"General\");\n  const extcategory = styleTab.appendCategory(\"ext\", \"Background Image\");\n\n  if (!data) {\n    const data = {\n      bool: \"\",\n      style: \"\",\n      ext: \"\"\n    };\n  }\n\n  for (let key in bool) {\n    configmenu.tabs[1].categories[0].appendOption(bool[key].name, key, 0, data.bool[key]);\n  }\n\n  for (let key in style) {\n    configmenu.tabs[1].categories[1].appendOption(style[key].name, key, 1, data.style[key]);\n  }\n\n  for (let key in ext) {\n    configmenu.tabs[1].categories[2].appendOption(ext[key].name, key, 1, data.ext[key]);\n  }\n\n  const saveButton = configmenu.appendButton(\"save\");\n  saveButton.addEventListener(\"click\", function () {\n    saveConfig(callback);\n    configmenu.kill();\n    configmenu = undefined;\n  });\n  const exportButton = configmenu.appendButton(\"export\");\n  exportButton.addEventListener(\"click\", function () {\n    exportConfig();\n  });\n  const importButton = configmenu.appendButton(\"import\");\n  importButton.addEventListener(\"click\", function () {\n    importConfig(callback);\n  });\n}\n\nfunction importConfig(callback) {\n  const importinput = document.createElement(\"input\");\n  importinput.setAttribute(\"type\", \"file\");\n  importinput.setAttribute(\"name\", \"importinput\");\n  configmenu.menu.appendChild(importinput);\n  importinput.addEventListener(\"change\", function (e) {\n    const file = importinput.files[0];\n    const reader = new FileReader();\n    reader.readAsText(file);\n\n    reader.onload = function (e) {\n      updateConfig(JSON.parse(reader.result));\n      applyConfig(JSON.parse(reader.result), callback);\n      configmenu.kill();\n    };\n  });\n  importinput.click();\n}\n\nfunction exportConfig() {\n  saveConfig();\n  browser.storage.local.get(\"config\").then(configData => {\n    window.open(\"data:application/octet-stream;base64,\" + window.btoa(JSON.stringify(configData.config, null, 2)));\n  }, err => {\n    alert(\"An error occured while exporting config.\");\n  });\n}\n\nfunction saveConfig(callback) {\n  let json = {\n    version: browser.runtime.getManifest().version,\n    squares: [],\n    bool: {},\n    style: {},\n    ext: {}\n  }; // squares\n\n  let searchSquareCount = 0;\n  const squares = configmenu.tabs[0].categories[0].options;\n\n  for (let i = 0; i < squares.length - 1; i++) {\n    if (squares[i].urls[1].className == \"squareOption\") {\n      searchSquareCount += 1;\n    }\n\n    if (searchSquareCount > 1) {\n      alert(\"Too many search squares.\");\n      throw \"Too many search squares.\";\n    }\n\n    let length;\n\n    try {\n      length = squares[i].urls[1].childNodes.length;\n    } catch (err) {\n      alert(err + \"\\nA square is probably empty.\");\n      throw err;\n    }\n\n    try {\n      if (squares[i].urls[1].className == \"squareOption\") {\n        for (let a = 2; a < squares[i].urls.length; a++) {\n          // dont allow options longer than one character\n          if (squares[i].urls[a].childNodes[1].value.length > 1) {\n            throw \"\\\"\" + squares[i].urls[a].childNodes[1].value + \"\\\"(\" + (i + 1) + \",\" + a + \") is too long\";\n          }\n        }\n      }\n    } catch (err) {\n      alert(err + \"\\nOptions can be no longer than one character.\");\n      throw err;\n    }\n\n    if (squares[i].urls[1].className == \"squareOption\") {\n      if (squares[i].urls[1].childNodes[1].value != \"default\") {\n        alert(\"Warning:\\n\" + \"\\\"\" + squares[i].urls[1].childNodes[1].value + \"\\\" will be used as default search option because it's the first one.\");\n      }\n    }\n\n    let sqr;\n\n    if (length !== 4) {\n      sqr = {\n        name: squares[i].urls[0].childNodes[1].value,\n        links: []\n      };\n\n      for (let a = 1; a < squares[i].urls.length; a++) {\n        const url = {\n          name: squares[i].urls[a].childNodes[1].value,\n          url: squares[i].urls[a].childNodes[2].value\n        };\n        sqr.links.push(url);\n      }\n    } else {\n      sqr = {\n        name: squares[i].urls[0].childNodes[1].value,\n        prefix: squares[i].urls[0].childNodes[2].value,\n        options: []\n      };\n\n      for (let a = 1; a < squares[i].urls.length; a++) {\n        const opt = {\n          opt: squares[i].urls[a].childNodes[1].value,\n          url: squares[i].urls[a].childNodes[2].value,\n          space: squares[i].urls[a].childNodes[3].value\n        };\n        sqr.options.push(opt);\n      }\n    }\n\n    json.squares.push(sqr);\n  } // style\n\n\n  for (let key in bool) {\n    const elem = document.querySelector(\"input[name='\" + key + \"'\");\n    bool[key].value = elem.checked;\n    json.bool[key] = elem.checked;\n  }\n\n  for (let key in style) {\n    const elem = document.querySelector(\"#style input[name='\" + key + \"'\");\n    style[key].value = elem.value;\n    json.style[key] = String(elem.value);\n  }\n\n  for (let key in ext) {\n    const elem = document.querySelector(\"#ext input[name='\" + key + \"'\");\n\n    if (elem.getAttribute(\"name\") == \"images\") {\n      const val = elem.value.replace(/\\s+/g, \"\").split(\",\");\n      ext[key].value = val;\n      json.ext[key] = val;\n    } else {\n      ext[key].value = elem.value;\n      json.ext[key] = String(elem.value);\n    }\n  }\n\n  browser.storage.local.set({\n    config: json\n  });\n  applyConfig(json, callback);\n}\n\nfunction applyConfig(data, callback) {\n  // squares\n\n  /* remove all existing squares, otherwise the old ones will still be\n   * displayed (without a page reload)\n   */\n  const container = document.getElementById(\"container\");\n\n  while (container.firstChild) {\n    container.removeChild(container.firstChild);\n  }\n\n  let normalSquares = [];\n  let searchSquare = undefined;\n\n  for (let i = 0; i < data.squares.length; i++) {\n    if (data.squares[i].links) {\n      normalSquares[i] = new Square(data.squares[i].name, {\n        isSearch: false,\n        links: data.squares[i].links\n      }, data.bool, data.style);\n\n      if (data.bool.alwaysopen) {\n        normalSquares[i].expand();\n      }\n    } else {\n      // otherwise expect this to be a search square\n      searchSquare = new Square(data.squares[i].name, {\n        isSearch: true,\n        prefix: data.squares[i].prefix,\n        options: data.squares[i].options\n      }, data.bool, data.style);\n      searchSquare.prefix = data.squares[i].prefix;\n\n      if (data.bool.alwaysopen) {\n        searchSquare.expand();\n      }\n    }\n  } // Append px if just a number\n\n\n  const px = s => isNaN(s) ? s : s + \"px\"; // style\n\n\n  const span = $(\"span\");\n  const a = $(\"a\");\n  const gearPath = $(\"#gearPath\");\n  const sqr = $(\".sqr\");\n  sqr.css(\"width\", px(data.style.square_size));\n\n  if (data.bool.alwaysopen) {\n    let maxHeight = 0;\n\n    for (let i = 0; i < normalSquares.length; ++i) {\n      let iMaxHeight = normalSquares[i].maxHeight();\n\n      if (iMaxHeight > maxHeight) {\n        maxHeight = normalSquares[i].maxHeight();\n      }\n    }\n\n    if (searchSquare) {\n      let sMaxHeight = searchSquare.maxHeight();\n\n      if (sMaxHeight > maxHeight) {\n        maxHeight = sMaxHeight;\n      }\n    }\n\n    sqr.css(\"height\", px(maxHeight));\n  } else {\n    sqr.css(\"height\", px(data.style.square_size));\n  }\n\n  sqr.css(\"margin\", \"0 \" + px(parseInt(data.style.square_spacing, 10) / 2));\n  span.css(\"lineHeight\", px(data.style.square_size));\n  span.css(\"fontFamily\", data.style.heading_font);\n  a.css(\"fontFamily\", data.style.link_font);\n  span.css(\"fontSize\", data.style.heading_font_size);\n  a.css(\"fontSize\", data.style.link_font_size);\n  $(\"body\").css(\"backgroundColor\", data.style.background);\n  sqr.css(\"backgroundColor\", data.style.foreground);\n  span.css(\"color\", data.style.heading_color);\n  a.css(\"color\", data.style.link_color);\n  const gear = $(\"#gear\");\n  const gearContainer = $(\"#gearContainer\");\n\n  if (data.bool.hide_gear_button) {\n    gear.css(\"opacity\", 0);\n    gearContainer.elements[0].addEventListener(\"mouseout\", e => {\n      gear.css(\"opacity\", 0);\n    });\n  } else {\n    gear.css(\"opacity\", 0.5);\n    gearContainer.elements[0].addEventListener(\"mouseout\", e => {\n      gear.css(\"opacity\", 0.5);\n    });\n  }\n\n  gearContainer.elements[0].addEventListener(\"mouseover\", e => {\n    gear.css(\"opacity\", 1);\n  });\n  gearPath.css(\"fill\", data.style.foreground);\n  sqr.css(\"borderColor\", data.style.border_color);\n  sqr.css(\"borderRadius\", data.style.border_radius);\n  sqr.css(\"boxShadow\", data.style.square_shadow);\n\n  if (!data.bool.alwaysopen) {\n    sqr.css(\"borderWidth\", data.style.border_width_normal);\n  }\n\n  const searchinput = $(\"#searchinput\");\n\n  if (searchinput !== null) {\n    searchinput.css(\"color\", data.style.search_color);\n    searchinput.css(\"backgroundColor\", data.style.search_bg_color);\n    searchinput.css(\"width\", px(data.style.square_size));\n  }\n\n  const bgimg = $(\"#bgimg\");\n\n  if (data.bool.background_image) {\n    bgimg.css(\"backgroundImage\", \"url('\" + data.ext.images[Math.floor(Math.random() * data.ext.images.length)] + \"')\");\n    bgimg.css(\"backgroundSize\", data.ext.size);\n    bgimg.css(\"filter\", data.ext.filter);\n  } else {\n    bgimg.css(\"backgroundImage\", \"\");\n  }\n\n  if (typeof callback === \"function\") {\n    callback({\n      normal: normalSquares,\n      search: searchSquare\n    });\n  }\n}\n\nvar _c;\n\n$RefreshReg$(_c, \"ConfigObject\");","map":{"version":3,"sources":["/home/ahmadqayyum/Desktop/info-for-nation/src/home/src/js/load-config.js"],"names":["ConfigObject","items","i","name","boolItems","borders","alwaysopen","background_image","hide_gear_button","bool","styleItems","square_size","square_spacing","heading_font","link_font","heading_font_size","link_font_size","background","foreground","heading_color","link_color","border_color","border_width_normal","border_width_hovered","border_radius","square_shadow","focus_color","focus_bg_color","search_color","search_bg_color","style","extItems","images","size","filter","ext","configmenuInit","callback","browser","storage","local","get","then","configData","Object","keys","length","constructor","$","loadJSON","configJSON","initmenu","Menu","appendTab","makeTabActive","initbuttons","split","addEventListener","set","config","applyConfig","kill","undefined","createMenu","err","alert","console","log","data","configmenu","squareTab","styleTab","node","normalcategory","appendCategory","squares","options","div","tabs","categories","appendSquareDiv","appendTextField","a","links","tf","url","prefix","opt","space","add","newDiv","opts","boolcategory","stylecategory","extcategory","key","appendOption","saveButton","appendButton","saveConfig","exportButton","exportConfig","importButton","importConfig","importinput","document","createElement","setAttribute","menu","appendChild","e","file","files","reader","FileReader","readAsText","onload","updateConfig","JSON","parse","result","click","window","open","btoa","stringify","json","version","runtime","getManifest","searchSquareCount","urls","className","childNodes","value","sqr","push","elem","querySelector","checked","String","getAttribute","val","replace","container","getElementById","firstChild","removeChild","normalSquares","searchSquare","Square","isSearch","expand","px","s","isNaN","span","gearPath","css","maxHeight","iMaxHeight","sMaxHeight","parseInt","gear","gearContainer","elements","searchinput","bgimg","Math","floor","random","normal","search"],"mappings":"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","sourcesContent":["function ConfigObject(items) {\n  for(let i in items) {\n    this[i] = { name: items[i] };\n  }\n}\n\nconst boolItems = {\n  borders: \"Borders\",\n  alwaysopen: \"Keep all squares open\",\n  background_image: \"Enable background image\",\n  hide_gear_button: \"Make gear button invisible\"\n};\nconst bool = new ConfigObject(boolItems);\n\nconst styleItems = {\n  square_size: \"Square Size\",\n  square_spacing: \"Square Spacing\",\n  heading_font: \"Heading Font\",\n  link_font: \"Link Font\",\n  heading_font_size: \"Heading Font Size\",\n  link_font_size: \"Link Font Size\",\n  background: \"Background\",\n  foreground: \"Foreground\",\n  heading_color: \"Heading Color\",\n  link_color: \"Link Color\",\n  border_color: \"Border Color\",\n  border_width_normal: \"Border Width\",\n  border_width_hovered: \"Border Width (Hovered)\",\n  border_radius: \"Border Radius\",\n  square_shadow: \"Square Shadow\",\n  focus_color: \"Focus Color\",\n  focus_bg_color: \"Focus Background Color\",\n  search_color: \"Search Color\",\n  search_bg_color: \"Search Background Color\"\n};\nconst style = new ConfigObject(styleItems);\n\nconst extItems = {\n  images: \"Images\",\n  size: \"Size\",\n  filter: \"Filter\"\n};\nconst ext = new ConfigObject(extItems);\n\n\nfunction configmenuInit(callback) {\n  browser.storage.local.get(\"config\").then(\n    (configData) => {\n      // Check if configData is empty\n      if(Object.keys(configData).length === 0\n         && configData.constructor === Object) {\n        $.loadJSON(\"config.json\", (configJSON) => {\n          initmenu = new Menu(\"Init-Menu\", 550, 350);\n          initmenu.appendTab(\"Choose an Option\");\n          initmenu.makeTabActive(0);\n          const initbuttons = initmenu.split(\n              [\"Use defaults.\",\n               \"Use configuration menu.\"],\n              [\"Use the example config. You can later open up the \" +\n               \"configuration menu by clicking the gear icon in the \" +\n               \"bottom-right corner of the screen.\",\n               \"Use a GUI to easily configure the startpage's style. Has \" +\n               \"import/export function.\"]);\n          initbuttons[0].addEventListener(\"click\", () => {\n            browser.storage.local.set({config: configJSON});\n            applyConfig(configJSON, callback);\n            initmenu.kill();\n          });\n          initbuttons[1].addEventListener(\"click\", () => {\n            browser.storage.local.set({config: configJSON});\n            applyConfig(configJSON, undefined);\n            createMenu(configJSON, callback);\n            initmenu.kill();\n          });\n        });\n      } else if(typeof callback === \"function\") {\n        applyConfig(configData.config, callback);\n      } else {\n        createMenu(configData.config, callback);\n      }\n    },\n    (err) => {\n      alert(\"An error occured while loading the config.\")\n      console.log(err);\n    }\n  );\n}\n\nfunction createMenu(data, callback) {\n  configmenu = new Menu(\"Config-Menu\", 750, -100);\n  const squareTab = configmenu.appendTab(\"Squares\");\n  const styleTab = configmenu.appendTab(\"Style\");\n  configmenu.makeTabActive(0);\n\n  squareTab.node.addEventListener(\"click\", function() {\n    configmenu.makeTabActive(0);\n  });\n  styleTab.node.addEventListener(\"click\", function() {\n    configmenu.makeTabActive(1);\n  });\n\n  // squares\n  const normalcategory = squareTab.appendCategory(\"normal\", undefined);\n\n  if(data.squares) {\n    let i = 0;\n    while(i < data.squares.length) {\n      if(data.squares[i].options === undefined) {\n        let div = configmenu.tabs[0]\n                            .categories[0]\n                            .appendSquareDiv(data.squares[i].name);\n        configmenu.tabs[0]\n                  .categories[0]\n                  .options[i]\n                  .appendTextField(\"heading\" + i, i, \"squareHeading\",\n                                   data.squares[i].name, 1, i, normalcategory);\n        for(let a = 0; a < data.squares[i].links.length; a++) {\n          const tf = configmenu.tabs[0]\n              .categories[0].options[i]\n              .appendTextField(\"link\" + i, [i, \"url\"], \"squareURL\",\n                               [data.squares[i].links[a].name,\n                                data.squares[i].links[a].url],\n                               2, i, normalcategory);\n        }\n      } else {\n        // search\n        let div = configmenu.tabs[0]\n                              .categories[0]\n                              .appendSquareDiv(data.squares[i].name);\n        configmenu.tabs[0]\n              .categories[0]\n              .options[i]\n              .appendTextField(\"heading\" + i, [i, \"prefix\"], \"squareHeading\",\n                               [data.squares[i].name, data.squares[i].prefix],\n                               2, i, normalcategory);\n        for(let a=0; a < data.squares[i].options.length; a++) {\n          const tf = configmenu.tabs[0]\n              .categories[0]\n              .options[i]\n              .appendTextField(\"option\" + i, [\"opt\", \"url\", \"space\"],\n                               \"squareOption\",\n                               [data.squares[i].options[a].opt,\n                                data.squares[i].options[a].url,\n                                data.squares[i].options[a].space],\n                               3, i, normalcategory);\n        }\n      }\n      if(data.squares[i].options === undefined) {\n        const add = configmenu.tabs[0]\n            .categories[0]\n            .options[i]\n            .appendTextField(\"link\" + i, undefined,\n                     \"squareURL\", undefined, 0, i, normalcategory);\n      } else {\n        const add = configmenu.tabs[0]\n            .categories[0]\n            .options[i]\n            .appendTextField(\"option\" + i, undefined, \"squareOption\",\n                     undefined, 0, i, normalcategory);\n      }\n      i++;\n    }\n    // square/search add button\n    const newDiv = normalcategory.appendSquareDiv();\n    const opts = configmenu.tabs[0].categories[0].options;\n    opts[opts.length-1].appendTextField(undefined, undefined, \"squareHeading\",\n                                        undefined, 0, i, normalcategory);\n    opts[opts.length-1].appendTextField(undefined, undefined,\n                                        \"squareHeading_addS\",\n                                        undefined, 0, i, normalcategory);\n  } else {\n    // empty squares\n    let div = configmenu.tabs[0]\n                        .categories[0]\n                        .appendSquareDiv(\"default\");\n    configmenu.tabs[0]\n              .categories[0]\n              .options[0]\n              .appendTextField(undefined, undefined, \"squareHeading\",\n                               undefined, 0, undefined, normalcategory);\n    configmenu.tabs[0]\n              .categories[0]\n              .options[0]\n              .appendTextField(undefined, undefined, \"squareHeading_addS\",\n                               undefined, 0, undefined, normalcategory);\n  }\n\n\n  // style\n  const boolcategory = styleTab.appendCategory(\"bool\", undefined);\n  const stylecategory = styleTab.appendCategory(\"style\", \"General\");\n  const extcategory = styleTab.appendCategory(\"ext\", \"Background Image\");\n\n  if(!data) {\n    const data = { bool:\"\",style:\"\",ext:\"\" };\n  }\n\n  for(let key in bool) {\n    configmenu.tabs[1].categories[0].appendOption(bool[key].name, key, 0,\n                                                  data.bool[key]);\n  }\n  for(let key in style) {\n    configmenu.tabs[1].categories[1].appendOption(style[key].name, key, 1,\n                                                  data.style[key]);\n  }\n  for(let key in ext) {\n    configmenu.tabs[1].categories[2].appendOption(ext[key].name, key, 1,\n                                                  data.ext[key]);\n  }\n\n  const saveButton = configmenu.appendButton(\"save\");\n  saveButton.addEventListener(\"click\", function() {\n    saveConfig(callback);\n    configmenu.kill();\n    configmenu = undefined;\n  });\n  const exportButton = configmenu.appendButton(\"export\");\n  exportButton.addEventListener(\"click\", function() {\n    exportConfig();\n  });\n  const importButton = configmenu.appendButton(\"import\");\n  importButton.addEventListener(\"click\", function() {\n    importConfig(callback);\n  });\n}\n\n\nfunction importConfig(callback) {\n  const importinput = document.createElement(\"input\");\n  importinput.setAttribute(\"type\", \"file\");\n  importinput.setAttribute(\"name\", \"importinput\");\n\n  configmenu.menu.appendChild(importinput);\n\n  importinput.addEventListener(\"change\", function(e) {\n    const file = importinput.files[0];\n\n    const reader = new FileReader();\n    reader.readAsText(file);\n\n    reader.onload = function(e) {\n      updateConfig(JSON.parse(reader.result));\n      applyConfig(JSON.parse(reader.result), callback);\n      configmenu.kill();\n    };\n  });\n\n  importinput.click();\n}\n\nfunction exportConfig() {\n  saveConfig();\n  browser.storage.local.get(\"config\").then(\n    (configData) => {\n      window.open(\"data:application/octet-stream;base64,\"\n                  + window.btoa(JSON.stringify(configData.config, null, 2)));\n    },\n    (err) => {\n      alert(\"An error occured while exporting config.\")\n    }\n  );\n}\n\nfunction saveConfig(callback) {\n  let json = {\n    version: browser.runtime.getManifest().version,\n    squares: [],\n    bool: {},\n    style: {},\n    ext: {}\n  };\n  // squares\n  let searchSquareCount = 0;\n  const squares = configmenu.tabs[0].categories[0].options;\n  for(let i = 0; i < (squares.length - 1); i++) {\n    if(squares[i].urls[1].className == \"squareOption\") {\n      searchSquareCount += 1;\n    }\n    if(searchSquareCount > 1) {\n      alert(\"Too many search squares.\");\n      throw \"Too many search squares.\";\n    }\n\n    let length;\n    try {\n      length = squares[i].urls[1].childNodes.length;\n    }\n    catch(err) {\n      alert(err + \"\\nA square is probably empty.\");\n      throw err;\n    }\n\n    try {\n      if(squares[i].urls[1].className == \"squareOption\") {\n        for(let a = 2; a < squares[i].urls.length; a++) {\n          // dont allow options longer than one character\n          if(squares[i].urls[a].childNodes[1].value.length > 1) {\n            throw \"\\\"\" + squares[i].urls[a].childNodes[1].value + \"\\\"(\" + (i+1)\n                  + \",\" + a + \") is too long\";\n          }\n        }\n      }\n    }\n    catch(err) {\n      alert(err + \"\\nOptions can be no longer than one character.\");\n      throw err;\n    }\n\n    if(squares[i].urls[1].className == \"squareOption\") {\n      if(squares[i].urls[1].childNodes[1].value != \"default\") {\n        alert(\"Warning:\\n\" + \"\\\"\" + squares[i].urls[1].childNodes[1].value +\n              \"\\\" will be used as default search option because it's the first one.\");\n      }\n    }\n\n    let sqr;\n    if(length !== 4) {\n      sqr = { name: squares[i].urls[0].childNodes[1].value, links: [] };\n      for(let a = 1; a < squares[i].urls.length; a++) {\n        const url = { name: squares[i].urls[a].childNodes[1].value,\n                      url: squares[i].urls[a].childNodes[2].value };\n        sqr.links.push(url);\n      }\n    } else {\n      sqr = { name: squares[i].urls[0].childNodes[1].value,\n                    prefix: squares[i].urls[0].childNodes[2].value,\n                    options: [] };\n      for(let a = 1; a < squares[i].urls.length; a++) {\n        const opt = { opt: squares[i].urls[a].childNodes[1].value,\n                      url: squares[i].urls[a].childNodes[2].value,\n                      space: squares[i].urls[a].childNodes[3].value};\n        sqr.options.push(opt);\n      }\n    }\n    json.squares.push(sqr);\n  }\n\n  // style\n  for(let key in bool) {\n    const elem = document.querySelector(\"input[name='\" + key + \"'\");\n    bool[key].value = elem.checked;\n    json.bool[key] = elem.checked;\n  }\n  for(let key in style) {\n    const elem = document.querySelector(\"#style input[name='\" + key + \"'\");\n    style[key].value = elem.value;\n    json.style[key] = String(elem.value);\n  }\n  for(let key in ext) {\n    const elem = document.querySelector(\"#ext input[name='\" + key + \"'\");\n    if(elem.getAttribute(\"name\") == \"images\") {\n      const val = elem.value.replace(/\\s+/g, \"\").split(\",\");\n      ext[key].value = val;\n      json.ext[key] = val;\n    } else {\n      ext[key].value = elem.value;\n      json.ext[key] = String(elem.value);\n    }\n  }\n\n  browser.storage.local.set({config: json});\n  applyConfig(json, callback);\n}\n\n\nfunction applyConfig(data, callback) {\n\n  // squares\n  /* remove all existing squares, otherwise the old ones will still be\n   * displayed (without a page reload)\n   */\n  const container = document.getElementById(\"container\");\n  while(container.firstChild) {\n    container.removeChild(container.firstChild);\n  }\n  let normalSquares = [];\n  let searchSquare = undefined;\n  for(let i = 0; i < data.squares.length; i++) {\n    if(data.squares[i].links) {\n      normalSquares[i] = new Square(data.squares[i].name,\n                                    {\n                                      isSearch: false,\n                                      links: data.squares[i].links\n                                    },\n                                    data.bool,\n                                    data.style);\n      if(data.bool.alwaysopen) {\n        normalSquares[i].expand();\n      }\n    } else {\n      // otherwise expect this to be a search square\n      searchSquare = new Square(data.squares[i].name,\n                                {\n                                  isSearch: true,\n                                  prefix: data.squares[i].prefix,\n                                  options: data.squares[i].options,\n                                },\n                                data.bool, data.style);\n      searchSquare.prefix = data.squares[i].prefix;\n      if(data.bool.alwaysopen) {\n        searchSquare.expand();\n      }\n    }\n  }\n\n  // Append px if just a number\n  const px = (s) => isNaN(s) ? s : s + \"px\";\n  // style\n  const span = $(\"span\");\n  const a = $(\"a\");\n  const gearPath = $(\"#gearPath\");\n  const sqr = $(\".sqr\");\n  sqr.css(\"width\", px(data.style.square_size))\n  if(data.bool.alwaysopen) {\n    let maxHeight = 0;\n    for(let i = 0; i < normalSquares.length; ++i) {\n      let iMaxHeight = normalSquares[i].maxHeight();\n      if(iMaxHeight > maxHeight) {\n        maxHeight = normalSquares[i].maxHeight();\n      }\n    }\n    if(searchSquare) {\n      let sMaxHeight = searchSquare.maxHeight();\n      if(sMaxHeight > maxHeight) {\n        maxHeight = sMaxHeight;\n      }\n    }\n    sqr.css(\"height\", px(maxHeight));\n  } else {\n    sqr.css(\"height\", px(data.style.square_size))\n  }\n  sqr.css(\"margin\", \"0 \" + px(parseInt(data.style.square_spacing, 10) / 2));\n  span.css(\"lineHeight\", px(data.style.square_size))\n  span.css(\"fontFamily\", data.style.heading_font);\n  a.css(\"fontFamily\", data.style.link_font);\n  span.css(\"fontSize\", data.style.heading_font_size);\n  a.css(\"fontSize\", data.style.link_font_size);\n  $(\"body\").css(\"backgroundColor\", data.style.background);\n  sqr.css(\"backgroundColor\", data.style.foreground);\n  span.css(\"color\", data.style.heading_color);\n  a.css(\"color\", data.style.link_color);\n  const gear = $(\"#gear\");\n  const gearContainer = $(\"#gearContainer\");\n  if(data.bool.hide_gear_button) {\n    gear.css(\"opacity\", 0);\n    gearContainer.elements[0].addEventListener(\"mouseout\", (e) => {\n      gear.css(\"opacity\", 0);\n    });\n  } else {\n    gear.css(\"opacity\", 0.5);\n    gearContainer.elements[0].addEventListener(\"mouseout\", (e) => {\n      gear.css(\"opacity\", 0.5);\n    });\n  }\n  gearContainer.elements[0].addEventListener(\"mouseover\", (e) => {\n    gear.css(\"opacity\", 1);\n  });\n  gearPath.css(\"fill\", data.style.foreground);\n  sqr.css(\"borderColor\", data.style.border_color);\n  sqr.css(\"borderRadius\", data.style.border_radius);\n  sqr.css(\"boxShadow\", data.style.square_shadow);\n  if(!data.bool.alwaysopen) {\n    sqr.css(\"borderWidth\", data.style.border_width_normal);\n  }\n  const searchinput = $(\"#searchinput\");\n  if(searchinput !== null) {\n    searchinput.css(\"color\", data.style.search_color);\n    searchinput.css(\"backgroundColor\", data.style.search_bg_color);\n    searchinput.css(\"width\", px(data.style.square_size))\n  }\n  const bgimg = $(\"#bgimg\");\n  if(data.bool.background_image) {\n    bgimg.css(\"backgroundImage\", \"url('\" + data.ext.images[\n      Math.floor(Math.random()*data.ext.images.length)] + \"')\");\n    bgimg.css(\"backgroundSize\", data.ext.size);\n    bgimg.css(\"filter\", data.ext.filter);\n  } else {\n    bgimg.css(\"backgroundImage\", \"\");\n  }\n\n  if(typeof callback === \"function\") {\n    callback({normal: normalSquares, search: searchSquare});\n  }\n}\n\n"]},"metadata":{},"sourceType":"module"}